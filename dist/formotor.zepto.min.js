/**
 * Formotor.js v0.1.0
 * (c) 2018 Felix Yang
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("zepto")):"function"==typeof define&&define.amd?define(["zepto"],t):e.Formotor=t(e.Zepto)}(this,function(p){"use strict";p=p&&p.hasOwnProperty("default")?p.default:p;var e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};function s(e,t){return-1!==Array.prototype.indexOf.call(e,t)}function r(e){return void 0===e}function o(e){return"string"==typeof e}function c(e){return"function"==typeof e}function _(e){return"[object Array]"===Object.prototype.toString.apply(e)}function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Array.prototype.slice.call(e,t)}function i(e){return/^[_$]/.test(e)}var n={silent:!1,eventHookRE:/^j-/,disabledClasses:"formit-component-disabled hidden",baseComponent:"basic"},u=p.extend({_eventSeparator:"|",_assetsType:["component","directive"],_lifecycleHooks:["init","ready"]},n);function t(e){return o(e)?n[e]:p.extend(!0,{},n)}function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;o(e)&&(n[e]=t),p.extend(!0,n,e)}function f(e,t,n){var o=e[t+"s"];if(o)return o[n]}function d(i,r){return u._assetsType.forEach(function(e){var t=r[e+"s"]||(r[e+"s"]={}),n=i[e+"s"];if(n)for(var o in n)t[o]=t[o]||n[o]}),function(e){var t=e.directives;if(t)for(var n in t){var o=t[n];c(o)&&(t[n]={bind:o})}}(r),r}function v(e,t){var n=e.$options[t];if(n)for(var o=0,i=n.length;o<i;o++)n[o].call(e);e.$trigger("hook:"+t)}var h=0;function m(t,n,o,e){var i=function(e){if(e.className){var t="";return e.className.split(" ").forEach(function(e){u.eventHookRE.test(e)&&(t+="."+e)}),t}}(n.el),r=o.split(u._eventSeparator).join(" ");_(e)||(e=[e]),e.forEach(function(e){i?$(t,o,i,e):p(n.el).on(r,e)})}function $(e,n,o,i){var t=e._proxyEvents||(e._proxyEvents=[]),r=n.split(u._eventSeparator).join(" "),s=!1;t.forEach(function(e){var t;e.e===n&&e.hook===o&&e.fn===i&&(t="proxy event repeated, name: "+n+", hookClass: "+o,u.silent||console.error("[Formotor Warn]: "+t),s=!0)}),s||(e.$el.on(r,o,i),t.push({e:n,hook:o,fn:i}))}function g(){}function y(e){e.forEach(function(t){var n,e="with(this){_excuteNode(node, {";t.directives&&(e+=(n="directives:[",t.directives.forEach(function(e){n+='{name:"'+e.name+'"'+(e.value?",value:("+e.value+"),expression:"+JSON.stringify(e.value):"")+(e.arg?',arg:"'+e.arg+'"':"")+(e.modifiers?",modifiers:"+JSON.stringify(e.modifiers):"")+"},"}),n.slice(0,-1)+"],")),t.events&&(e+=function(e){var t="on:{";for(var n in e.events)t+='"'+n+'":'+b(e.events[n])+",";return t.slice(0,-1)+"}"}(t)+","),e=e.replace(/,$/,"")+"});}",t.code=e;try{t.render=new Function("node",t.code)}catch(e){t.render=g}})}function b(e){var t=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*$/,n={stop:"$event.stopPropagation();",prevent:"$event.preventDefault();",self:"if($event.target !== $event.currentTarget)return;"};if(e){if(_(e))return"["+e.map(b).join(",")+"]";if(e.modifiers){var o="function($event){";for(var i in e.modifiers)o+=n[i]||x(i);return o+(t.test(e.value)?e.value+"($event)":e.value)+"}"}return t.test(e.value)?e.value:"function($event){"+e.value+"}"}return"function(){}"}function x(e){var t=parseInt(e,10)||{esc:27,tab:9,enter:13,space:32,up:38,left:37,right:39,down:40,delete:[8,46]}[e];return t?_(t)?"if("+t.map(function(e){return"$event.keyCode!=="+e}).join("&&")+")return;":"if($event.keyCode!=="+t+")return;":""}var C,E,k,V,j,w=/^fi-|^@/,S=/^@|^fi-on:/,N=/:(.*)$/,O=/\.[^.]+/g;function A(e){return p(e).get(0)}function M(e){var r={el:A(e),nodes:[],subComponents:[]};return function n(e){var y,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o={el:A(e),attrsMap:{}},i=function(e){p(e).children().each(function(e,t){n(t)})};return t?i(o.el):((y=o).dirCount=0,p.each(y.el.attributes,function(e,t){var n,o,i,r,s,a,u,c,l,f,p,d,v=t.name,h=t.value,m=void 0,$=void 0,g=void 0;w.test(v)&&(y.attrsMap[v]=h,y.dirCount++,(m=function(e){var t=e.match(O),n={};if(t)return t.forEach(function(e){n[e.slice(1)]=!0}),n}(v))&&(v=v.replace(O,"")),S.test(v)?(v=v.replace(S,""),u=v,c=h,l=m,f=(a=y).events||(a.events={}),p={value:c,modifiers:l},_(d=f[u])?d.push(p):f[u]=d?[d,p]:p):(v=v.replace(w,""),(g=v.match(N))&&($=g[1])&&(v=v.slice(0,-($.length+1))),"component"===v?y.component=h:(o=v,i=h,r=$,s=m,(n=y).directives=n.directives||[],n.directives.push({name:o,value:i,arg:r,modifiers:s}))))}),o.component?(1<o.dirCount&&r.nodes.push(o),r.subComponents.push({el:o.el,name:o.component})):(o.dirCount&&r.nodes.push(o),i(o.el))),o}(r.el,!0),y(r.nodes),r}function R(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._init(e)}function P(e,t,n){return n=!!r(n)||!!n,p.extend(n,{},e,t)}(C=R).prototype._init=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this;return t._cid=h++,t._isFormitComponent=!0,t._disabled=!1,e&&e._isSubComponent?t.$options=d(e._parent.$options,e||{}):t.$options=d(t.constructor.options,e||{}),t.$el=p(t.$options.el),t.$parent=t.$options._parent||null,t.$root=t.$parent?t.$parent.$root:t,t.$options._component&&(t.$name=t.$options._component,t.$primary=t.$el.find('[name="'+t.$name+'"]')),t._initData(),t._initHooks(),t._initMethods(),t._initEvents(),v(t,"init"),t._scan(),t._render(),t._initProxies(),t._registerRefs(),t._createSubComponent(),v(t,"ready"),t},C.prototype._initData=function(){var e=this,t=e.$options.data;if(t)for(var n in t=c(t)?t():t)i(n)||(c(t[n])?e[n]=t[n]():e[n]=t[n]);return e.model||(e.model=e.$parent?e.$parent.model:{}),e},C.prototype._initMethods=function(){var e=this,t=e.$options.methods;if(t)for(var n in t)i(n)||(e[n]=p.proxy(t[n],e),e[n]._isMethod=!0);return e},R.prototype._initHooks=function(){var n=this;return u._lifecycleHooks.forEach(function(e){var t=n.$options[e]||[];n.$options[e]=_(t)?t:[t]}),n},(E=R).prototype._initEvents=function(){var n=this,e=n.$options.events;if(n._events={},e){var o=void 0,t=function(t){!_(o=e[t])&&o&&(o=[o]),o&&o.length&&o.forEach(function(e){n[e]&&n[e]._isMethod&&n.$on(t,n[e])})};for(var i in e)t(i)}return n},E.prototype.$on=function(e,t){return(this._events[e]||(this._events[e]=[])).push(t),this},E.prototype.$off=function(e,t){var n=this;if(!arguments.length)return n._events={},n;var o=n._events[e];if(!o)return n;if(1===arguments.length)return n._events[e]=null,n;for(var i=void 0,r=o.length;r--;)if((i=o[r])===t||i.fn===t){o.splice(r,1);break}return n},E.prototype.$once=function(e,t){var n=this;function o(){n.$off(e,o),t.apply(n,arguments)}return o.fn=t,n.$on(e,o),n},E.prototype.$trigger=function(e){var t=this._events[e];if(t){E.prototype.$allbacks=1<t.length?a(t):t;for(var n=Array.prototype.slice.call(arguments,1),o=0,i=t.length;o<i;o++)t[o].apply(this,n)}return this},E.prototype.$listen=function(){var e=Array.prototype.slice.call(arguments);return this.$root.$on.apply(this.$root,e),this},E.prototype.$broadcast=function(){var e=Array.prototype.slice.call(arguments);return this.$root.$trigger.apply(this.$root,e),this},(k=R).prototype._scan=function(){return this._binding=M(this.$el),this},k.prototype._render=function(){var t=this;return t._binding.nodes.forEach(function(e){e.render.call(t,e)}),t},k.prototype._executeNode=function(a,e){var u=this;if(e.directives&&e.directives.length&&e.directives.forEach(function(e){var t,n,o,i,r,s;n=a,o=e,i="bind",r=f((t=u).$options,"directive",o.name),(s=r?r[i]:null)&&s(n.el,o,t)}),e.on)for(var t in e.on)m(u,a,t,e.on[t]);return u},k.prototype._createSubComponent=function(){var s=this,e=s._binding.subComponents,a=s.$children||(s.$children=[]);return e.forEach(function(e){var t,n,o,i,r=(t=k,o=e,(i=f((n=s).$options,"component",o.name))||(i=f(n.$options,"component",u.baseComponent)),new t(p.extend(!0,{el:o.el,_component:o.name,_parent:n,_isSubComponent:!0},i)));r&&a.push(r)}),s},k.prototype._registerRefs=function(){var e=this,t=e.$root._refs||(e.$root._refs={});return e.$name&&(t[e.$name]||(t[e.$name]=[])).push(e),e},(V=R).prototype._initProxies=function(){var e=this,t=e.$options.proxies;if(t){var n=void 0,o=void 0,i=void 0;for(var r in t)i=t[r],n=(r=r.split(" "))[0],o=r.slice(1).join(" "),i&&e[i]&&e[i]._isMethod&&n&&o&&$(e,n,o,e[i])}return e},V.prototype.$find=function(e){return this.$el.find(e)},(j=R).prototype.$set=function(t){var e=this,n=t||e.model;e._disabled?c(e.setDisabledValues)&&e.setDisabledValues():n&&(c(e.setValues)?e.setValues(n):e.$children.length?e.$children.forEach(function(e){t?e.$set(t):e.$set()}):e.$setValues(n))},j.prototype.$get=function(){var e=this,t=void 0;return e._disabled?c(e.getDisabledValues)?e.getDisabledValues():{}:(c(e.getValues)?t=e.getValues():e.$children.length?e.$children.forEach(function(e){t=p.extend(t,e.$get())}):t=e.$getValues(),t)},j.prototype.$setValues=function(e,t){return function(e,n,o){var i=p(e),t=i.find(":input"),r={},s=void 0;if(n){for(o=o||{};t.length;)(s=t.get(0).name)?(r[s]=t.filter('[name="'+s+'"]'),t=t.not('[name="'+s+'"]')):t=t.slice(1);p.each(o,function(e){r[e]||(r[e]=p())}),p.each(r,function(e){var t=n[e];c(o[e])?o[e].apply(this,[i,t,n]):null!=t&&p(this).formit("setValue",t)})}}(this.$el,e,t),this},j.prototype.$getValues=function(e,t){var n,o,i,r;return n=this.$el,o=e,i=t,r=p(n),o=p.extend({},o),i=p.extend({trimText:!0},i),r.formit("getValues",o,i)},j.prototype.$provideRef=function(){return c(this.provideRef)?this.provideRef():this.$get()},j.prototype.$callRef=function(e,t){var n=this.$root._refs[e],o={};if(e&&n)return n.forEach(function(e){o=p.extend(o,e.$provideRef())}),t||(o=o[e]),o},j.prototype.$disable=function(e){var t=this;return r(e)?t._disabled:(t._disabled=!!e,t._disabled?t.$el.addClass(u.disabledClasses):t.$el.removeClass(u.disabledClasses),t)};var T={postName:"data-post-name",ignore:".fm-ignore",accessible:".fm-accessible",disableMode:!(j.prototype.$disableFormElements=function(e,t){return e=!!r(e)||!!e,t=t||"*",c(this.disableFormElements)?this.disableFormElements(e,t):this.$find(":input").filter(t).prop("disabled",e),this}),middlewares:{trim:{"textarea,[type=text]":function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").trim()}}}};function D(e){return o(e)?T[e]:p.extend(!0,{},T)}function F(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;o(e)&&(T[e]=t),p.extend(!0,T,e)}var z={tag:/^(?:input|select|textarea|keygen)/i,check:/^(?:checkbox|radio)$/i,select:/^(?:select)$/i,invalidTags:/^(?:submit|button|image|reset|file)$/i};function H(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return e.map(function(){return this.elements?a(this.elements):this}).filter(function(){return function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.postName,o=t.ignore,i=t.accessible,r=t.disableMode,s=p(e),a=!z.invalidTags.test(e.type),u=e.name||s.attr(n),c=e.checked||!z.check.test(e.type),l=!s.is(o),f=!!r||!s.is(":disabled:not("+i+")");return a&&u&&c&&f&&l}(this,t)}).map(function(){return function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=e.postName,o=e.middlewares,i=p(n),r=i.is(":checkbox")||i.is("select[multiple]"),s=i.attr(t)||n.name,a=i.val();return p.each(o,function(e,t){p.each(t,function(e,t){i.is(e)&&c(t)&&(a=_(a)?a.map(function(e){return t.call(n,e)}):t.call(n,a))})}),null==a?null:_(a)?p.map(a,function(e){return{name:s,value:e,multi:r}}):{name:s,value:a,multi:r}}(this,t)}).get()}function Z(r){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=(3<arguments.length&&void 0!==arguments[3]?arguments[3]:{}).postName,a=function(e){var t='[name="'+e+'"],['+n+'="'+e+'"]';return r.find(t).add(r.filter(t))};p.each(s,function(e,t){var n=i[e],o=a(e);c(n)?n.apply(o,[r,t,s]):J(o,t)}),p.each(i,function(e,t){var n,o,i=a(e);c(t)&&(n=s,o=e,!Object.prototype.hasOwnProperty.call(n,o))&&t.apply(i,[r,null,s])})}function J(e,t){e.each(function(){var e=p(this);z.check.test(this.type)?(t=(t=_(t)?t:[t]).map(function(e){return e.toString?e.toString():e}),this.checked=s(t,this.value)):e.val(t)})}var q,I,W,B=e({},Object.freeze({getValue:function(e){var n=void 0,o=!1,i=function(e,t){null!=e&&(r(n)?(n=t?[e]:e,t&&(o=!0)):(o||(n=[n],o=!0),n.push(e)))};return e.each(function(){var e=p(this);if(z.check.test(this.type)){var t=e.is(":checkbox");this.checked&&i(this.value,t)}else i(e.val(),!1)}),n},setValue:J,getValues:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=p.extend(!0,{},T,n),i=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i={},r=[];return p.each(e,function(){var e=this.name,t=this.value,n=this.multi;if(i[e])if(_(i[e])&&s(r,e))i[e].push(t);else{var o=i[e];i[e]=[o],i[e].push(t),r.push(e)}else i[e]=n?[t]:t,n&&r.push(e)}),i}(H(e.is("form")?e:e.find(":input"),o)),r=function(r){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},a=t.postName,u={};return p.each(e,function(e,t){if(c(t)){var n='[name="'+e+'"],['+a+'="'+e+'"]',o=r.find(n).add(r.filter(n)),i=t.apply(o,[r,s]);null!=i&&(u[e]=i)}}),u}(e,t,o,p.extend(!0,{},i));return p.extend(i,r)},setValues:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};Z(e,t,n,p.extend(!0,{},T,o))}}));return(q=R).getProtoConfig=D,q.setProtoConfig=F,p.fn.formotor=function(n){return o(n)?function(){var e=B[n],t=[this].concat(a(arguments));return e?e.apply(this,t):this}.apply(this,a(arguments).slice(1)):this},(I=R).JZ=p,I.extend=P,I.setConfig=l,I.getConfig=t,(W=I).options={},u._assetsType.forEach(function(e){W.options[e+"s"]={}}),u._assetsType.forEach(function(n){W[n]=function(e,t){return t?this.options[n+"s"][e]=t:this.options[n+"s"][e]}}),W.component("basic",{}),R.version="0.1.0",R});
